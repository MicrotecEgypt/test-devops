<lib-page-content>
  <form [formGroup]="addForm">
    <div class="grid m-0">
      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['code']">
            {{ 'PaymentIn.Form.Code' | translate }}
          </lib-label>
          <lib-text-input
            type="text"
            formControlName="code"
            [readOnly]="true"
            [placeholder]="'PaymentIn.Form.PlaceholderCode' | translate"
          />
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['journalDate']">
            {{ 'PaymentIn.Form.Date' | translate }}
          </lib-label>
          <lib-calendar
                     formControlName="journalDate"
          ></lib-calendar>
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['description']">
            {{ 'PaymentIn.Form.Description' | translate }}
          </lib-label>
          <lib-text-input
            type="text"
            formControlName="description"
            [placeholder]="'PaymentIn.Form.PlaceholderDescription' | translate"
          />
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['paymentHubId']">
            {{ 'PaymentIn.Form.PaymentHub' | translate }}
          </lib-label>
          <lib-select
          formControlName="paymentHubId"
          [options]="lookups[LookupEnum.PaymentPlace]"
          [selectedValue]="addForm.controls['paymentHubId'].value"
          (valueChanged)="getDetails()"
          optionValue="id"
          optionLabel="name"
         
        >
        </lib-select>
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['paymentHubDetails']">
            {{ 'PaymentIn.Form.PaymentHubDetails' | translate }}
          </lib-label>
          <lib-select
            formControlName="paymentHubDetails"
            [options]="BankDropDown"
            optionValue="id"
            optionLabel="name"
            [placeholder]="'PaymentIn.Form.PlaceholderPaymentHubDetails' | translate"
          ></lib-select>
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['bankAccountId']">
            {{ 'PaymentIn.Form.BankAccount' | translate }}
          </lib-label>
          <lib-select
            formControlName="bankAccountId"
            [options]="paymentHubDetails"
            optionValue="id"
            optionLabel="name"
            [placeholder]="'PaymentIn.Form.PlaceholderBankAccount' | translate"
          ></lib-select>
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['currency']">
            {{ 'PaymentIn.Form.Currency' | translate }}
          </lib-label>
          <lib-text-input
            type="text"
            formControlName="currency"
            [placeholder]="'PaymentIn.Form.PlaceholderCurrency' | translate"
            [readOnly]="true"
          />
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['rate']">
            {{ 'PaymentIn.Form.Rate' | translate }}
          </lib-label>
          <lib-text-input
            type="number"
            formControlName="rate"
            [placeholder]="'PaymentIn.Form.PlaceholderRate' | translate"
          />
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['sourceDocument']">
            {{ 'PaymentIn.Form.SourceDocument' | translate }}
          </lib-label>
          <lib-text-input
            type="text"
            formControlName="sourceDocument"
            [placeholder]="'PaymentIn.Form.PlaceholderSourceDocument' | translate"
            [readOnly]="true"
          />
        </lib-form-group>
      </div>

      <div class="md:col-4">
        <lib-form-group>
          <lib-label [appControl]="addForm.controls['createdJournal']">
            {{ 'PaymentIn.Form.CreatedJournal' | translate }}
          </lib-label>
          <lib-text-input
            type="text"
            formControlName="createdJournal"
            [placeholder]="'PaymentIn.Form.PlaceholderCreatedJournal' | translate"
            [readOnly]="true"
          />
        </lib-form-group>
      </div>
    </div>
      <div class="grid border">
        <div class="md:col-4">
          <lib-form-group>
            <lib-label [appControl]="addForm.controls['currentBalance']">
              {{ 'PaymentIn.Form.CurrentBalance' | translate }}
            </lib-label>
            <lib-text-input
              type="text"
              formControlName="currentBalance"
              [readOnly]="true"
              [placeholder]="'PaymentIn.Form.PlaceholderCurrentBalance' | translate"
            />
          </lib-form-group>
        </div>

        <div class="md:col-4">
          <lib-form-group>
            <lib-label [appControl]="addForm.controls['totalReceivedAmount']">
              {{ 'PaymentIn.Form.TotalReceivedAmount' | translate }}
            </lib-label>
            <lib-text-input
              type="text"
              formControlName="totalReceivedAmount"
              [placeholder]="'PaymentIn.Form.PlaceholderTotalReceivedAmount' | translate"
              [readOnly]="true"
            />
          </lib-form-group>
        </div>

        <div class="md:col-4">
          <lib-form-group>
            <lib-label [appControl]="addForm.controls['newBalance']">
              {{ 'PaymentIn.Form.NewBalance' | translate }}
            </lib-label>
            <lib-text-input
              type="text"
              formControlName="newBalance"
              class="newBalance"
              [placeholder]="'PaymentIn.Form.PlaceholderNewBalance' | translate"
              [readOnly]="true"
            />
          </lib-form-group>
        </div>
      </div>
  </form>

  <div class="entry_tableCont">
    <div class="card">
      <p-table
      [resizableColumns]="true" 
      [value]="journalEntryLinesFormArray.controls"
        dataKey="id"
        styleClass="p-datatable-gridlines p-datatable-striped"
        [tableStyle]="{ 'min-width': '50rem' }"
      >
        <ng-template pTemplate="header">
          <tr>
            <th >{{ 'PaymentIn.Table.Amount' | translate }}</th>
            <th >{{ 'PaymentIn.Table.LocalAmount' | translate }}</th>
            <th >{{ 'PaymentIn.Table.PaymentMethod' | translate }}</th>
            <th >{{ 'PaymentIn.Table.PaymentMethodDetails' | translate }}</th>
            <th >{{ 'PaymentIn.Table.PaidBy' | translate }}</th>
            <th >{{ 'PaymentIn.Table.PaidByDetails' | translate }}</th>
            <th >{{ 'PaymentIn.Table.LinkedGLAccount' | translate }}</th>
            <th >{{ 'PaymentIn.Table.CostCenter' | translate }}</th>
            <th >{{ 'PaymentIn.Table.Notes' | translate }}</th>
            <th >{{ 'EditJournal.Actions' | translate }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-journalLine let-rowIndex="rowIndex">
          <tr [formGroup]="journalLine">
            <td [pEditableColumn]="journalLine.amount"
             pEditableColumnField="amount">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <div class="flex gap-2 align-items-center">
                    <!-- <lib-select
                      formControlName="amount"
                      optionValue="id"
                      optionLabel="displayName"
                    >
                    </lib-select>

                    <i class="pi pi-search search-circle" (click)="openDialog()"></i>
                   -->
                    <lib-text-input
                    formControlName="amount"
                    >

                    </lib-text-input>
                  </div>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ journalLine.get('amount').value }}
                </ng-template>
              </p-cellEditor>
              <lib-field-validations [appControl]="journalLine.controls['amount']">
              </lib-field-validations>
            </td>
            <td>
              {{ journalLine.controls['amount']?.value *2 }}
            </td>
            <td
             [pEditableColumn]="journalLine.paymentMethodId"
              pEditableColumnField="paymentMethodId">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <lib-select
                  formControlName="paymentMethodId"
                  [options]="lookups[LookupEnum.PaymentMethodType]"
                  [selectedValue]="journalLine.controls['paymentMethodId'].value"
                  optionValue="id"
                  optionLabel="name"
                  >

                  </lib-select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ journalLine.controls['paymentMethodId'].value  }}
                </ng-template>
              </p-cellEditor>
              <lib-field-validations [appControl]="journalLine.controls['paymentMethodId']"> </lib-field-validations>
              
            </td>
            <td>
              <lib-button-micro 
              title="{{ 'PaymentIn.Form.PaymentMethod' | translate }}"
              [nameClass]="journalLine.controls['paymentMethodId'].value == SharedJournalEnums.paymentmethodtype.Cash ? 'disabled' : 'save'"
              widthNumber="100%"
              (click)="openDialog(journalLine.controls['paymentMethodId'].value)"
              >

              </lib-button-micro>
            </td>
            <td
              [pEditableColumn]="journalLine.controls['paidBy']"
              pEditableColumnField="paidBy"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <lib-select
                  formControlName="paidBy"
                  [options]="paidBy"
                  [selectedValue]="journalLine.controls['paidBy'].value"
                  optionValue="id"
                  optionLabel="name"
                  (valueChanged)="getpaidByDetails(journalLine.controls['paidBy'].value)"
                  >

                  </lib-select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ journalLine.controls['paidBy'].value}}
                </ng-template>
              </p-cellEditor>
              <lib-field-validations [appControl]="journalLine.controls['paidBy']"> </lib-field-validations>
            </td>
            <td
              [pEditableColumn]="journalLine.controls['paidByDetailsId']"
              pEditableColumnField="paidByDetailsId"
            >
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <lib-select
                  formControlName="paidByDetailsId"
                  [options]="paidByDetails"
                  [selectedValue]="journalLine.controls['paidByDetailsId'].value"
                  optionValue="id"
                  optionLabel="name"
                  >

                  </lib-select>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ journalLine.controls['paidByDetailsId'].value}}
                </ng-template>
              </p-cellEditor>
              <lib-field-validations [appControl]="journalLine.controls['paidByDetailsId']"> </lib-field-validations>
            </td>
            <td [pEditableColumn]="journalLine.glAccountId" pEditableColumnField="glAccountId">
              <p-cellEditor>
                <ng-template pTemplate="input">
                  <div class="flex gap-2 align-items-center">
                    <lib-select
                      formControlName="glAccountId"
                      [options]="filteredAccounts"
                      optionValue="id"
                      optionLabel="displayName"
                      [customClass]="'add-journal'"
                      
                      (valueSearchChanged)="onFilter($event)"
                      placeholder=" {{ journalLine.get('accountCode').value }}"
                    >
                    </lib-select>

                    <i
                      class="pi pi-search search-circle"
                      (click)="openDialog(rowIndex)"
                    ></i>
                  </div>
                </ng-template>
                <ng-template pTemplate="output">
                  {{ journalLine.get('accountCode').value }}
                </ng-template>
              </p-cellEditor>
              <lib-field-validations [appControl]="journalLine.controls['glAccountId']">
              </lib-field-validations>
            </td>
            <td>
              <lib-form-group>
                <lib-text-input type="number" formControlName="currencyRate"></lib-text-input>
                <lib-field-validations [appControl]="journalLine?.get('currencyRate')">
                </lib-field-validations>
              </lib-form-group>
            </td>
            <td>
              {{ journalLine.controls['debitAmountLocal'].value | numberFormat }}
            </td>
            <td>
              {{ journalLine.controls['creditAmountLocal'].value | numberFormat }}
            </td>
            <td>
              <img src="assets/images/groups.png" />

              <img src="assets/images/groups-mandtory-optional.png" alt="" class="pointer" />
              <img class="pointer" src="assets/images/costcenterfull.png" />
            </td>
            <td>
              <img src="assets/images/table/delete.svg" class="pointer" alt="" />
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="footer">
          <tr>
            <td class="total"></td>
            <td class="total"></td>
          </tr>
        </ng-template>
      </p-table>

      <div class="add_new">
        <button class="btn" type="button" (click)="addNewRow()" >
          {{ 'add_new_line' | translate }}
        </button>
      </div>
    </div>
  </div>
  <div class="btn_group">
    <div class="grid">
      <div class="md:col-3">
        <div class="grid">
          <div class="md:col-6">
            <lib-button-micro
              title="{{ 'Cancel' | translate }}"
              nameClass="cancel"
              widthNumber="100%"
            >
            </lib-button-micro>
          </div>
          <div class="md:col-6">
            <div>
              <lib-button-micro
                title="{{ 'Save' | translate }}"
                nameClass="save"
                widthNumber="100%"
                type="button"
              >
              </lib-button-micro>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="btn_group">
    <div class="grid">
      <div class="md:col-3">
        <div class="grid">
          <div class="md:col-6">
            <!-- <lib-button-micro
              title="Payment method"
              nameClass="save"
              widthNumber="100%"
              (click)="openDialog()"
              >
            </lib-button-micro> -->
          </div>
        </div>
      </div>
    </div>
  </div>



</lib-page-content>
