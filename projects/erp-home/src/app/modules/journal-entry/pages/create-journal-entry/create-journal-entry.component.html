<div class="journal_entry_add_page">
    <lib-bread-crumb></lib-bread-crumb>
    <div [formGroup]="fg" class="entry_header">
        <p class="title test">Please Enter journal entry Header</p>
        <div class="grid">
            <div class="col-12 md:col-3 ">
                <lib-text-input  placeholder="Reference Number" [iconUrl]="'https://static.thenounproject.com/png/101791-200.png'" formControlName="refrenceNumber">

                </lib-text-input>
            </div>
            <div class="col-12 md:col-3 ">
                <lib-text-input placeholder="Journal Date" type="date" formControlName="journalDate"></lib-text-input>
            </div>
            <div class="col-12 md:col-3 ">
                <lib-text-input placeholder="Journal Period" formControlName="periodId" [readOnly]="true">
                </lib-text-input>
            </div>
            <div class="col-12 md:col-3 ">
                <button (click)="openAttachments()">Attach</button>
            </div>
            <div class="col-12 md:col-12 ">
                <lib-text-input placeholder="Description" formControlName="description"></lib-text-input>
            </div>
        </div>
    </div>
    <div class="entry_table">
        <div class="card">
            <p-table [value]="things" dataKey="id" styleClass="p-datatable-gridlines p-datatable-striped" [tableStyle]="{ 'min-width': '50rem' }">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Id</th>
                        <th>Acc. Code</th>
                        <th>Acc. Name</th>
                        <th>Line Description</th>
                        <th>DB Amount</th>
                        <th>CR Amount</th>
                        <th>Currency</th>
                        <th>Rate</th>
                        <th>DB Amount Local</th>
                        <th>CR Amount Local</th>
                        <td></td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item let-editing="editing" let-i="rowIndex"> 
                    <tr>
                        <td>{{item.id}}</td>
                        <td [pEditableColumn]="item.accountId" pEditableColumnField="accountId">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-autoComplete [(ngModel)]="item.account" (onSelect)="accountSelected($event, item.id)" 
                                    [forceSelection]="true" [suggestions]="filteredAccounts" 
                                    #autocomplete (onFocus)="!autocomplete.value && autocomplete.show()"
                                    (completeMethod)="filterAccount($event)" field="accountCode"></p-autoComplete>
                                    <button (click)="openDialog(i)">open</button>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ item.account?.accountCode }}
                                </ng-template>
                            </p-cellEditor>
                        </td>
                        <td>
                            {{ item.account?.nameEn }}
                        </td>
                        <td [pEditableColumn]="item.lineDescription" pEditableColumnField="lineDescription">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input [(ngModel)]="item.lineDescription"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ item.lineDescription }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="item.debitAmount" pEditableColumnField="debitAmount">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input [(ngModel)]="item.debitAmount" type="number"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ item.debitAmount }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="item.creditAmount" pEditableColumnField="creditAmount">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input [(ngModel)]="item.creditAmount" type="number"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ item.creditAmount }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="item.currency" pEditableColumnField="currency">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <p-autoComplete [(ngModel)]="item.currency" [forceSelection]="true" [suggestions]="fitleredCurrencies" (completeMethod)="filterCurrency($event)" field="currencyName"></p-autoComplete>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ item.currency?.currencyName }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td [pEditableColumn]="item.rate" pEditableColumnField="rate">
                            <p-cellEditor>
                                <ng-template pTemplate="input">
                                    <lib-text-input [(ngModel)]="item.currencyRate" type="number"></lib-text-input>
                                </ng-template>
                                <ng-template pTemplate="output">
                                    {{ item.currencyRate }}
                                </ng-template>
                            </p-cellEditor>
                        </td>

                        <td>
                            {{ item.debitAmountLocal | number:'1.0-2'}}
                        </td>

                        <td>
                            {{ item.creditAmountLocal | number:'1.0-2' }}
                        </td>

                        <td>
                            <button (click)="deleteLine(i)">Delete</button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <div class="add_new">
            <button class="btn Line" (click)="addThing()">
                Add New Line
            </button>
            <button class="btn">
                Add Template
            </button>
            <button (click)="test()">test</button>
        </div>
        <div class="paginator">
            <lib-paginator
            [totalRecords]="50"
            [first]="0"
            [rows]="10"
            ></lib-paginator>
        </div>

        <div class="btn_group">
            <button class="btn discard">
                discard
            </button>
            <button class="btn save" (click)="save()">
                Save
            </button>
        </div>
    </div>

</div>